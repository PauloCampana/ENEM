# Análise exploratória de dados

regular text here nothing to see officer

```{r}
#| warning: false
library(tidyverse)
```

```{r}
microdados <- "dados/microdados0.parquet" |>
    arrow::open_dataset() |>
    collect()
```

```{r}
theme_darkly <- function(b = "#21252b", d = "#282c34", t = "#ffffff") {
    theme(
        rect = element_rect(fill = b, linewidth = 0),
        panel.background = element_blank(),
        strip.background = element_blank(),
        legend.key       = element_blank(),
        panel.grid.major = element_line(colour = d),
        panel.grid.minor = element_blank(),
        text             = element_text(colour = t),
        axis.text        = element_text(colour = t),
        axis.title       = element_text(colour = t, size = 12),
        legend.title     = element_text(colour = t, size = 12),
        strip.text       = element_text(colour = t, size = 12),
        strip.placement  = "outside"
    )
}
```

```{r}
#| out-width: 100%
microdados |>
    select(sexo, MT:R) |>
    rename(
        "Matemática"              = MT,
        "Ciências da \n Natureza" = CN,
        "Ciência \n Humanas"      = CH,
        "Linguagens \n e Códigos" = LC,
        "Redação"                 = R
    ) |>
    pivot_longer(-sexo, names_to = "área", values_to = "nota") |>
    ggplot(aes(x = nota, fill = sexo, color = sexo)) +
    geom_density(alpha = 1/3) +
    facet_grid(rows = vars(área), switch = "y") +
    scale_colour_manual(
        values = c("#ff4080", "#4080ff"),
        aesthetics = c("colour", "fill")
    ) +
    coord_cartesian(xlim = c(300, 1000)) +
    scale_x_continuous(breaks = seq(300, 1000, by = 100)) +
    labs(x = "Notas") +
    guides(
        fill = guide_legend(title = "Sexo"),
        color = guide_legend(title = "Sexo")
    ) +
    theme_darkly() +
    theme(
        axis.text.y = element_blank(),
        axis.title.y = element_blank()
    )
```

```{r}
microdados |>
    filter(R != 0) |>
    select(idade, MT:R) |>
    transmute(
        idade = idade,
        nota = (MT + CN + CH + LC + R) / 5
    ) |>
    ggplot(aes(x = nota, y = idade, fill = idade, color = idade)) +
    ggridges::geom_density_ridges(rel_min_height = 0.005, scale = 3) +
    scale_fill_viridis_d(option = "F", begin = 0.25) +
    scale_color_viridis_d(option = "F", begin = 0) +
    coord_cartesian(xlim = c(300, 820)) +
    scale_x_continuous(breaks = seq(300, 800, by = 100)) + 
    labs(x = "Notas", y = "Idade") +
    theme_darkly() +
    theme(legend.position = "none")
```

